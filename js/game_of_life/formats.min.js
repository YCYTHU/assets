"use strict";var MIN_BUFFER_SIZE=256,MAX_BUFFER_SIZE=16777216,DENSITY_ESTIMATE=.009,formats=function(){return{parse_rle:e,parse_pattern:function r(t){return"!"===(t=t.replace(/\r/g,""))[0]?function e(r){var t=n(r,"!");r=t.pattern_string;for(var s=[],a=[],u=0,o=0,l=r.length,i=0;i<l;i++)switch(r[i]){case".":u++;break;case"O":s.push(u++),a.push(o);break;case"\n":o++,u=0;break;case"\r":case" ":break;default:return{error:"Plaintext: Syntax Error"}}return t.field_x=s,t.field_y=a,t}(t):/^(?:#[^\n]*\n)*\n*(?:(?:x|y|rule|color|alpha) *= *[a-z0-9\/(),]+,? *)+\s*\n/i.test(t)?e(t):"#Life 1.06"===t.substr(0,10)?function e(r){for(var t,n=/\s*(-?\d+)\s+(-?\d+)\s*(?:\n|$)/g,s=[],a=[];t=n.exec(r);)s.push(Number(t[1])),a.push(Number(t[2]));return{field_x:s,field_y:a}}(t):{error:"Format detection failed."}},rule2str:s,parse_rule:u,parse_comments:n,generate_rle:function e(r,t,n){let s=[];t&&s.push("#N "+t),s.push.apply(s,n.map(e=>"#C "+e)),r.root;let a=r.get_root_bounds();{var u,o;let l=a.right-a.left+1,i=a.bottom-a.top+1,f,$=(u=r.rule_s,o=r.rule_b,f=(f=formats.rule2str(u,o)).split("/"),f=`B${f[1]}/S${f[0]}`);s.push(`x = ${l}, y = ${i}, rule = ${$}`)}let c="";for(let h of function* e(r,t){function n(e,r){if(console.assert(e>=0),0===e)return"";let t="";return e>1&&(t=String(e)),t+(r?"b":"o")}for(let s=t.top;s<=t.bottom;s++){let a=!0,u=t.left;for(let o=t.left;o<=t.right;o++){let l=!r.get_bit(o,s),i=o-u;console.assert(i>=0),a!==l&&(yield n(i,a),u=o,a=l)}if(!a){let f=t.right+1-u;yield n(f,a)}s!==t.bottom&&(yield"$")}yield"!"}(r,a))c.length+h.length>70&&(console.assert(h.length<70),s.push(c),c=""),c+=h;return s.push(c),s.join("\n")}};function e(e){var t,u=n(e,"#"),o=0,l=0,i=/([a-zA-Z]+) *= *([a-zA-Z0-9\/()]+)/g,f=(e=u.pattern_string).indexOf("\n");if(-1===f)return{error:"RLE Syntax Error: No Header"};for(;t=i.exec(e.substr(0,f));)switch(t[1]){case"x":u.width=Number(t[2]);break;case"y":u.height=Number(t[2]);break;case"rule":u.rule_s=a(t[2],!0),u.rule_b=a(t[2],!1),u.comment+="\nRule: "+s(u.rule_s,u.rule_b)+"\n",u.rule=s(u.rule_s,u.rule_b);break;case"alpha":case"color":break;default:return{error:"RLE Syntax Error: Invalid Header: "+t[1]}}var $=MIN_BUFFER_SIZE;if(u.width&&u.height){var c=u.width*u.height;c>0&&($=Math.max($,c*DENSITY_ESTIMATE|0),$=Math.min(MAX_BUFFER_SIZE,$))}for(var h,_=1,b=!1,m=new Int32Array($),p=new Int32Array($),d=0,g=e.length;f<g;f++)if((h=e.charCodeAt(f))>=48&&h<=57)b?(_*=10,_+=48^h):(_=48^h,b=!0);else{if(98===h)o+=_;else if(h>=65&&h<=90||h>=97&&h<122)for(d+_>m.length&&(m=r(m),p=r(p));_--;)m[d]=o++,p[d]=l,d++;else if(36===h)l+=_,o=0;else if(33===h)break;_=1,b=!1}return u.field_x=new Int32Array(m.buffer,0,d),u.field_y=new Int32Array(p.buffer,0,d),u}function r(e){var r=new Int32Array(1.5*e.length|0);return r.set(e),r}function t(e){return n(e,"#")}function n(e,r){for(var t,n,s,a={comment:"",urls:[],short_comment:""},u="#"===r;e[0]===r;){if(t=e.indexOf("\n"),n=e.substr(1,t-1),s=!0,u)switch(n=n.substr(1).trim(),e[1]){case"N":n?a.title=n:a.rule="23/3",s=!1;break;case"C":case"D":a.short_comment||(a.short_comment=n);break;case"O":a.author=n;break;case"R":a.rule=n,s=!1;break;default:s=!1}s&&(/^(?:https?:\/\/|www\.)[a-z0-9]/i.test(n)?("http"!==n.substr(0,4)&&(n="http://"+n),a.urls.push(n)):"Name:"===n.substr(0,5)?a.title=n.substr(5):(a.comment+=n,70!==t&&80!==t&&(a.comment+="\n"))),e=e.substr(t+1)}return a.pattern_string=e,a.comment=a.comment.trim(),a}function s(e,r){for(var t="",n=0;e;e>>=1,n++)1&e&&(t+=n);t+="/";for(var n=0;r;r>>=1,n++)1&r&&(t+=n);return t}function a(e,r){return!!(e=e.split("/"))[1]&&(Number(e[0])?u(e.join("/"),r):("b"===e[0][0].toLowerCase()&&e.reverse(),u(e[0].substr(1)+"/"+e[1].substr(1),r)))}function u(e,r){for(var t=0,n=e.split("/")[r?0:1],s=0;s<n.length;s++){var a=Number(n[s]);if(isNaN(a)||t&1<<a)return!1;t|=1<<a}return t}}();