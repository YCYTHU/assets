"use strict";function LifeCanvasDrawer(){var t,i,e,l,o,r,n,c,d=0,h=0,u=this,a=1;function f(e,l,o){var d=o-n,h=d;if(e<0&&(d+=e,e=0),e+d>t&&(d=t-e),l<0&&(h+=l,l=0),l+h>i&&(h=i-l),!(d<=0)&&!(h<=0))for(var u=e+l*t,a=t-d,f=c.r|c.g<<8|c.b<<16|-16777216,w=0;w<h;w++){for(var s=0;s<d;s++)r[u]=f,u++;u+=a}}function w(t,i,e){t?(d-=Math.round((d-i)/2),h-=Math.round((h-e)/2),u.cell_width/=2):(d+=Math.round(d-i),h+=Math.round(h-e),u.cell_width*=2)}function s(e){w(e,t>>1,i>>1)}function _(t){for(;u.cell_width>t;)s(!0);for(;2*u.cell_width<t;)s(!1)}function $(t){return 4===t.length?{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16)}:{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16)}}this.cell_color=null,this.background_color=null,this.border_width=0,this.init=function t(i){return!!(e=document.createElement("canvas")).getContext&&(u.canvas=e,l=e.getContext("2d"),i.appendChild(e),!0)},this.redraw=function e(a){var w=$(u.background_color),s=w.r|w.g<<8|w.b<<16|-16777216;n=u.border_width*u.cell_width|0,c=$(u.cell_color);for(var _=t*i,v=0;v<_;v++)r[v]=s;var g=Math.pow(2,a.level-1)*u.cell_width;(function e(l,o,r,n){0!==l.population&&!(r+o+d<0)&&!(n+o+h<0)&&!(r+d>=t)&&!(n+h>=i)&&(o<=1?l.population&&f(r+d|0,n+h|0,1):0===l.level?l.population&&f(r+d,n+h,u.cell_width):(o/=2,e(l.nw,o,r,n),e(l.ne,o,r+o,n),e(l.sw,o,r,n+o),e(l.se,o,r+o,n+o)))})(a,2*g,-g,-g),l.putImageData(o,0,0)},this.move=function t(i,e){d+=Math.round(i*a),h+=Math.round(e*a)},this.zoom_at=function t(i,e,l){w(i,e*a,l*a)},this.zoom_centered=s,this.fit_bounds=function e(l){var o,r,n,c=l.right-l.left,a=l.bottom-l.top;isFinite(c)&&isFinite(a)?(_(o=Math.min(16,t/c,i/a)),r=Math.round(t/2-(l.left+c/2)*u.cell_width),n=Math.round(i/2-(l.top+a/2)*u.cell_width)):(_(16),r=t>>1,n=i>>1),d=r,h=n},this.set_size=function n(c,d){if(c!==t||d!==i){e.style.width=c+"px",e.style.height=d+"px";var h,h=window.devicePixelRatio;a=h,e.width=Math.round(c*h),e.height=Math.round(d*h),t=e.width,i=e.height,o=l.createImageData(t,i),r=new Int32Array(o.data.buffer);for(var u=0;u<c*d;u++)r[u]=-16777216}},this.draw_cell=function t(i,e,o){var r=i*u.cell_width+d,n=e*u.cell_width+h,c=Math.ceil(u.cell_width)-(u.cell_width*u.border_width|0);o?l.fillStyle=u.cell_color:l.fillStyle=u.background_color,l.fillRect(r,n,c,c)},this.center_view=function e(){d=t>>1,h=i>>1},this.zoom_to=_,this.pixel2cell=function t(i,e){return{x:Math.floor((i*a-d+u.border_width/2)/u.cell_width),y:Math.floor((e*a-h+u.border_width/2)/u.cell_width)}}}