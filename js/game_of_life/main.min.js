"use strict";var DEFAULT_BORDER=.25,DEFAULT_FPS=20;!function(){var e=document.title,t="";if(document.addEventListener){var n,o,i,r,l,a,c=!1,s=!1,u="/assets/game_of_life/examples/",d=!1,p=new LifeUniverse,f=new LifeCanvasDrawer,h="turingmachine,Turing Machine|gunstar,Gunstar|hacksaw,Hacksaw|tetheredrake,Tethered rake|primer,Primer|infinitegliderhotel,Infinite glider hotel|p94s,P94S|breeder1,Breeder 1|tlogtgrowth,tlog(t) growth|logt2growth,Log(t)^2 growth|infinitelwsshotel,Infinite LWSS hotel|c5greyship,c/5 greyship".split("|"),m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||setTimeout;window.onload=function(){if(d)return;if(d=!0,t=document.querySelector("meta[name=description]").content,!f.init(document.body)){L(F("notice").getElementsByTagName("h4")[0],"Canvas-less browsers are not supported. I'm sorry for that.");return}(function e(){F("about_close").style.display="inline",U(F("notice")),x(),N(F("toolbar")),N(F("statusbar")),N(F("about_main"));var t,d,h=document.createElement("style"),D=500;document.head.appendChild(h),window.onresize=(t=function(){f.set_size(window.innerWidth,document.body.offsetHeight),requestAnimationFrame(z.bind(0,p.root))},function(){var e=this,n=arguments;clearTimeout(d),d=setTimeout(function(){t.apply(e,Array.prototype.slice.call(n))},500)}),F("gen_step").onchange=function(e){if("number"===this.type){var t=Number(this.value);t&&(t<=1?this.value=1:this.value=Math.pow(2,Math.round(Math.log(t)/Math.LN2)),this.step=this.value/2)}},F("run_button").onclick=function(){var e,t,n,i,r,l;c?v():(i=0,r=1e3/a,l=r,L(F("run_button"),"Stop"),c=!0,0===p.generation&&p.save_rewind_state(),n=setInterval(function(){E(1e3/r)},666),t=(e=Date.now())-l,!function a(){if(!c){clearInterval(n),E(1e3/r),o&&o();return}var s=Date.now();l*i<s-e&&(p.next_generation(!0),f.redraw(p.root),i++,r+=(-t-r+(t=s))/15,r<.7*l&&(i=1,e=Date.now())),m(a)}())},F("step_button").onclick=function(){c||w(!0)},F("superstep_button").onclick=function(){c||w(!1)},F("clear_button").onclick=function(){v(function(){C(),L(F("pattern_name"),""),Y(""),p.clear_pattern(),E(),f.center_view(),f.redraw(p.root)})},F("rewind_button").onclick=function(){p.rewind_state&&v(function(){p.restore_rewind_state(),g(),f.redraw(p.root),E()})},f.canvas.onmousedown=function(e){if(3===e.which||2===e.which){if(f.cell_width>=1){var t=f.pixel2cell(e.clientX,e.clientY);l=!p.get_bit(t.x,t.y),window.addEventListener("mousemove",A,!0),A(e)}}else 1===e.which&&(i=e.clientX,r=e.clientY,window.addEventListener("mousemove",X,!0),function e(){null!==i&&requestAnimationFrame(e),z(p.root)}());return!1};var S=!1,B=0;function M(e){return console.assert(e.length>=2),Math.sqrt((e[0].clientX-e[1].clientX)*(e[0].clientX-e[1].clientX)+(e[0].clientY-e[1].clientY)*(e[0].clientY-e[1].clientY))}f.canvas.addEventListener("touchstart",function(e){if(2===e.touches.length)S=!0,B=M(e.touches),e.preventDefault();else if(1===e.touches.length){var t={which:1,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY};f.canvas.onmousedown(t),e.preventDefault()}},!1),f.canvas.addEventListener("touchmove",function(e){if(S){let t=M(e.touches),n=!1;for(;B-t>50;)B-=50,f.zoom_centered(!0),n=!0;for(;B-t<-50;)B+=50,f.zoom_centered(!1),n=!0;n&&(E(),z(p.root))}else X({clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY}),e.preventDefault()},!1),f.canvas.addEventListener("touchend",function(e){window.onmouseup(e),e.preventDefault(),S=!1},!1),f.canvas.addEventListener("touchcancel",function(e){window.onmouseup(e),e.preventDefault(),S=!1},!1),window.onmouseup=function(e){i=null,r=null,window.removeEventListener("mousemove",A,!0),window.removeEventListener("mousemove",X,!0)},window.onmousemove=function(e){var t=f.pixel2cell(e.clientX,e.clientY);L(F("label_mou"),t.x+", "+t.y),T(F("label_mou"))},f.canvas.oncontextmenu=function(e){return!1},f.canvas.onmousewheel=function(e){return e.preventDefault(),f.zoom_at(0>(e.wheelDelta||-e.detail),e.clientX,e.clientY),E(),z(p.root),!1},f.canvas.addEventListener("DOMMouseScroll",f.canvas.onmousewheel,!1),window.onkeydown=function(e){var t=e.which,n=!1,o=e.target.nodeName;if("INPUT"===o||"TEXTAREA"===o||e.ctrlKey||e.shiftKey||e.altKey)return!0;if(37===t||72===t)f.move(15,0),n=!0;else if(38===t||75===t)f.move(0,15),n=!0;else if(39===t||76===t)f.move(-15,0),n=!0;else if(40===t||74===t)f.move(0,-15),n=!0;else if(27===t)return x(),!1;else if(13===t)return F("run_button").onclick(),!1;else if(32===t)return F("step_button").onclick(),!1;else if(9===t)return F("superstep_button").onclick(),!1;else if(189===t||173===t||109===t)f.zoom_centered(!0),n=!0;else if(187===t||61===t)f.zoom_centered(!1),n=!0;else if(8===t)return F("rewind_button").onclick(),!1;else if(219===t||221===t){var i=p.step;return 219===t?i--:i++,i>=0&&(p.set_step(i),L(F("label_step"),Math.pow(2,i))),!1}return!n||(z(p.root),!1)},F("faster_button").onclick=function(){var e=p.step+1;p.set_step(e),L(F("label_step"),Math.pow(2,e))},F("slower_button").onclick=function(){if(p.step>0){var e=p.step-1;p.set_step(e),L(F("label_step"),Math.pow(2,e))}},F("normalspeed_button").onclick=function(){p.set_step(0),L(F("label_step"),1)},F("zoomin_button").onclick=function(){f.zoom_centered(!1),E(),z(p.root)},F("zoomout_button").onclick=function(){f.zoom_centered(!0),E(),z(p.root)},F("initial_pos_button").onclick=function(){g(),z(p.root),E()},F("middle_button").onclick=function(){f.center_view(),z(p.root)};for(var O=[["ne",1,-1],["nw",-1,-1],["se",1,1],["sw",-1,1],["n",0,-1],["e",-1,0],["s",0,1],["w",1,0],],W=0;W<O.length;W++)document.getElementById(O[W][0]+"_button").onclick=function(e){return function(){f.move(-30*e[1],-30*e[2]),z(p.root)}}(O[W]);for(var q=F("select_rules").getElementsByTagName("span"),W=0;W<q.length;W++)q[W].onclick=function(){F("rule").value=this.getAttribute("data-rule")};F("import_submit").onclick=function(){var e=n&&n.title,t=F("import_file").files;function o(t){_(t,void 0),e!==n.title&&(y(n),F("import_file").value="")}if(t&&t.length){let i=new FileReader;i.onload=function(){o(i.result)},i.readAsText(t[0])}else o(F("import_text").value)},F("import_abort").onclick=function(){x()},F("import_button").onclick=function(){k("import_dialog"),F("import_text").value="",L(F("import_info"),"")},F("export_button").onclick=function(){let e=formats.generate_rle(p,void 0,["Generated by copy.sh/life"]);(function e(t,n){var o=document.createElement("a");if(o.download=n,o.href=window.URL.createObjectURL(new Blob([t])),o.dataset.downloadurl=["text/plain",o.download,o.href].join(":"),document.createEvent){var i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)}else o.click();window.URL.revokeObjectURL(o.href)})(e,"pattern.rle")},F("randomize_button").onclick=function(){F("randomize_density").value=.5,F("randomize_width").value=200,F("randomize_height").value=200,k("randomize_dialog")},F("randomize_submit").onclick=function(){let e=Math.max(0,Math.min(1,+F("randomize_density").value))||.5,t=Math.max(0,+F("randomize_width").value)||200,o=Math.max(0,+F("randomize_height").value)||200;v(function(){p.clear_pattern();let i=new Int32Array(Math.round(t*o*e)),r=new Int32Array(i.length);for(let l=0;l<i.length;l++)i[l]=Math.random()*t,r[l]=Math.random()*o;var a=p.get_bounds(i,r);p.make_center(i,r,a),p.setup_field(i,r,a),p.save_rewind_state(),x(),g(),z(p.root),E(),L(F("pattern_name"),"Random pattern"),C("Random pattern"),n={title:"Random pattern",comment:""}})},F("settings_submit").onclick=function(){x(),e=formats.parse_rule(F("rule").value,!0),t=formats.parse_rule(F("rule").value,!1),n=Math.round(Math.log(Number(F("gen_step").value)||0)/Math.LN2),p.set_rules(e,t),!n||n<0?(p.set_step(0),L(F("label_step"),"1")):(p.set_step(n),L(F("label_step"),Math.pow(2,n))),(a=Number(F("max_fps").value))&&!(a<0)||(a=DEFAULT_FPS),f.border_width=parseFloat(F("border_width").value),(isNaN(f.border_width)||f.border_width<0||f.border_width>.5)&&(f.border_width=DEFAULT_BORDER);var e,t,n,o=document.createTextNode(".button,.menu>div{background-color:"+f.cell_color+";box-shadow:2px 2px 4px "+f.cell_color+"}#statusbar>div{border-color:"+f.cell_color+"}");h.appendChild(o),F("pattern_name").style.color=F("statusbar").style.color=f.cell_color,F("statusbar").style.textShadow="0px 0px 1px "+f.cell_color,F("toolbar").style.color=f.background_color,z(p.root)},F("settings_reset").onclick=function(){b(),z(p.root),x()},F("settings_button").onclick=function(){k("settings_dialog"),F("rule").value=formats.rule2str(p.rule_s,p.rule_b),F("max_fps").value=a,F("gen_step").value=Math.pow(2,p.step),F("border_width").value=f.border_width},F("settings_abort").onclick=F("pattern_close").onclick=F("alert_close").onclick=F("randomize_abort").onclick=F("about_close").onclick=function(){x()},F("pattern_name").onclick=function(){y(n)},F("about_button").onclick=function(){k("about")},F("pattern_button").onclick=function e(){if(s){k("pattern_chooser");return}s=!0,s=!0,k("loading_popup"),R(u+"list",function(e){var t=e.split("\n"),o=F("pattern_list");k("pattern_chooser"),t.forEach(function(e){var t=e.split(" ")[0],i=e.split(" ")[1],r=document.createElement("div"),l=document.createElement("span");L(r,t),L(l,i),l.className="size",r.appendChild(l),o.appendChild(r),r.onclick=function(){k("loading_popup"),R($(t),function(e){_(e,t),Y(t),y(n),p.set_step(0),L(F("label_step"),"1")})}})})}})(),f.set_size(window.innerWidth,document.body.offsetHeight),b();for(var e,D=location.search.substr(1).split("&"),S={},B=0;B<D.length;B++)S[(e=D[B].split("="))[0]]=e[1];if(S.step&&/^\d+$/.test(S.step)){var M=Math.round(Math.log(Number(S.step))/Math.LN2);p.set_step(M)}let O=S.pattern,W=O&&/^[a-z0-9_\.\-]+$/i.test(O),q=S.gist;if(q&&/^[a-fA-F0-9]+$/.test(q)){k("loading_popup");let I="finish_load_gist"+(2147483647*Math.random()|0);window[I]=function(e){let t=e.data.files;if(t)for(let n of Object.keys(t)){let o=t[n],i=o.raw_url,r="https://copy.sh/life/?gist="+q;_(o.content,void 0,i,r,n)}else W?j(O):K()};let P=document.createElement("script");P.src="https://api.github.com/gists/"+q+"?callback="+I,document.getElementsByTagName("head")[0].appendChild(P)}else W?"1"===S.meta?K():j(O):K();if("1"===S.noui)for(var H=["statusbar","about_button","examples_menu","import_button","settings_button","zoomout_button","zoomin_button","clear_button","superstep_button","step_button","rewind_button"],B=0;B<H.length;B++)F(H[B]).style.display="none";function j(e){k("loading_popup"),R($(e),function(e){_(e,O)},function(){K()})}function K(){var e=h[Math.random()*h.length|0].split(",")[0];k("loading_popup"),R($(e),function(t){_(t,e)})}S.fps&&/^\d+$/.test(S.fps)&&(a=+S.fps)},document.addEventListener("DOMContentLoaded",window.onload,!1)}function $(e,t){return(e.endsWith(".mc")||(e+=".rle"),t&&"localhost"!==location.hostname)?("http:"===location.protocol?"http:":"https:")+"//copy.sh/life/"+u+e:u+e}function v(e){c?(c=!1,L(F("run_button"),"Run"),o=e):e&&e()}function b(){f.background_color="#000000",f.cell_color="#cccccc",f.border_width=DEFAULT_BORDER,f.cell_width=2,p.rule_b=8,p.rule_s=12,p.set_step(0),L(F("label_step"),"1"),a=DEFAULT_FPS,L(F("label_zoom"),"1:2"),T(F("label_mou")),f.center_view()}function _(e,o,i,r,l){let a=e.startsWith("[M2]");if(a)c={comment:"",urls:[],short_comment:""};else{var c=formats.parse_pattern(e.trim());if(c.error){L(F("import_info"),c.error);return}}v(function(){if(l&&!c.title&&(c.title=l),o&&!c.title&&(c.title=o),p.clear_pattern(),a)c=load_macrocell(p,e),p.set_step(15),L(F("label_step"),32768);else{var s,u=p.get_bounds(c.field_x,c.field_y);p.make_center(c.field_x,c.field_y,u),p.setup_field(c.field_x,c.field_y,u)}p.save_rewind_state(),c.rule_s&&c.rule_b?p.set_rules(c.rule_s,c.rule_b):p.set_rules(12,8),x(),g(),f.redraw(p.root),E(),L(F("pattern_name"),c.title||"no name"),C(c.title),document.querySelector("meta[name=description]").content=c.comment.replace(/\n/g," - ")+" - "+t,!i&&o&&(i=$(o,!0)),!r&&o&&(r=(s=o,("http:"===location.protocol?"http:":"https:")+"//copy.sh/life/?pattern="+s)),n={title:c.title,comment:c.comment,urls:c.urls,view_url:r,source_url:i}})}function g(){var e=p.get_root_bounds();f.fit_bounds(e)}function w(e){var t=Date.now();0===p.generation&&p.save_rewind_state(),p.next_generation(e),f.redraw(p.root),E(1e3/(Date.now()-t)),t<3&&L(F("label_fps"),"> 9000")}function y(e){if(e.title||e.comment||e.urls.length){for(let t of(k("alert"),L(F("pattern_title"),e.title||""),L(F("pattern_description"),e.comment||""),F("pattern_urls").innerHTML="",e.urls)){let n=document.createElement("a");n.href=t,n.textContent=t,n.target="_blank",F("pattern_urls").appendChild(n),F("pattern_urls").appendChild(document.createElement("br"))}e.view_url?(N(F("pattern_link_container")),L(F("pattern_link"),e.view_url),F("pattern_link").href=e.view_url):U(F("pattern_link_container")),e.source_url?(N(F("pattern_file_container")),L(F("pattern_file_link"),e.source_url),F("pattern_file_link").href=e.source_url):U(F("pattern_file_container"))}}function k(e){N(F("overlay")),document.body.style.overflow="auto";for(var t=F("overlay").children,n=0;n<t.length;n++){var o=t[n];o.id===e?N(o):U(o)}}function x(){U(F("overlay")),document.body.style.overflow="hidden"}function E(e){e&&L(F("label_fps"),e.toFixed(1)),L(F("label_gen"),M(p.generation," ")),T(F("label_gen")),L(F("label_pop"),M(p.root.population," ")),T(F("label_pop")),f.cell_width>=1?L(F("label_zoom"),"1:"+f.cell_width):L(F("label_zoom"),1/f.cell_width+":1")}function z(e){(!c||a<15)&&f.redraw(e)}function L(e,t){e.textContent=String(t)}function T(e){e.style.padding="0",e.style.width="",(!e.last_width||e.last_width<e.offsetWidth)&&(e.last_width=e.offsetWidth),e.style.padding="",e.style.width=e.last_width+"px"}function D(e){return!!/^#(?:[a-f0-9]{3}|[a-f0-9]{6})$/i.test(e)&&e}function R(e,t,n){var o=new XMLHttpRequest;return o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(o.responseText,e):n&&n(o.responseText,o.status))},o.open("get",e,!0),o.send(""),{cancel:function(){o.abort()}}}function S(e,t,n){var o,i=e.length,r=0,l=!1;o=e.map(function(e){return R(e.url,function(n){!l&&(e.onready&&e.onready(n),++r===i&&t())},function(e,t){if(!l){l=!0,n();for(var i=0;i<o.length;i++)o[i].cancel()}})})}function X(e){if(null!==i){let t=Math.round(e.clientX-i),n=Math.round(e.clientY-r);f.move(t,n),i+=t,r+=n}}function A(e){var t=f.pixel2cell(e.clientX,e.clientY);(t.x!==i||t.y!==r)&&(p.set_bit(t.x,t.y,l),E(),f.draw_cell(t.x,t.y,l),i=t.x,r=t.y)}function F(e){return document.getElementById(e)}function Y(e){window.history.replaceState&&(e?window.history.replaceState(null,"","?pattern="+e):window.history.replaceState(null,"","/life/"))}function C(t){t?document.title=t+" - "+e:document.title=e}function U(e){e.style.display="none"}function N(e){e.style.display="block"}function B(e,t){for(;e.length<t;)e="0"+e;return e}function M(e,t){return e<0?"-"+M(-e,t):isNaN(e)||!isFinite(e)||e>=1e21?e+"":function e(n){return n.length<3?n:e(n.slice(0,-3))+t+n.slice(-3)}(e+"")}}();