const canvas1=document.getElementById("vector_field_div"),canvas2=document.getElementById("vector_field_curl"),dpr=window.devicePixelRatio||1,ctx1=initializeCanvas(canvas1,dpr),ctx2=initializeCanvas(canvas2,dpr),bounds={x:0,y:0,width:canvas1.width/dpr,height:canvas1.height/dpr},MAX_PARTICLE_AGE=100,PARTICLE_MULTIPLIER=10,FRAME_RATE=25,LINE_WIDTH=1,EVOLVE_STEP=.5,COLORMAP=[[58,76,192],[103,136,237],[153,186,254],[200,215,239],[237,208,193],[246,167,137],[225,104,82],[179,3,38]],particleCount=Math.round(10*bounds.width),particles1=Array.from({length:particleCount},()=>randomizeParticle({})),particles2=Array.from({length:particleCount},()=>randomizeParticle({})),vectorField1=createVectorField("div"),vectorField2=createVectorField("curl"),vectorColorRange1=calculateColorLim(vectorField1),vectorColorScale1=calculateColorScale(255,vectorColorRange1,COLORMAP),vectorColorRange2=calculateColorLim(vectorField2),vectorColorScale2=calculateColorScale(255,vectorColorRange2,COLORMAP);function initializeCanvas(e,t){let o=e.getContext("2d"),r=document.getElementsByClassName("article__content")[0].offsetWidth;return e.style.backgroundColor="#000",e.width=.75*r*t,e.height=.421875*r*t,e.style.width=`${.75*r}px`,e.style.height=`${.421875*r}px`,o.translate(0,e.height),o.scale(t,-t),o}function createVectorField(e="default"){return"div"===e?{interpolate(e,t){e=(e-bounds.width/2)/(bounds.height/3),t=(t-bounds.height/2)/(bounds.height/3);let o=t*(1-2*e*e)*Math.exp(-(e*e+t*t)),r=e*(1-2*t*t)*Math.exp(-(e*e+t*t)),l=Math.sqrt(o*o+r*r),i=1.5*o/l,n=1.5*r/l,a=(e**3*t+e*t**3-3*e*t)*Math.exp(-(e*e+t*t));return[i,n,Math.sqrt(i*i+n*n),a]}}:"curl"===e?{interpolate(e,t){e=(e-bounds.width/2)/(bounds.height/3),t=(t-bounds.height/2)/(bounds.height/3);let o=6*e*t/(e*e+t*t),r=6*t*t/(e*e+t*t)-2,l=-6*e/Math.sqrt(e*e+t*t);return[o,r,Math.sqrt(o*o+r*r),l]}}:void 0}function calculateColorLim(e,t=1e3){let o=-1/0,r=1/0;for(let l=0;l<t;l++){let i=Math.random()*bounds.width,n=Math.random()*bounds.height,[,,,a]=e.interpolate(i,n);a>o&&(o=a),a<r&&(r=a)}return r===o&&(o+=1,r-=1),[r,o]}function calculateColorScale(e,t,o){function r(e,t,o){return e.map((e,r)=>Math.round(e+o*(t[r]-e)))}let l=[];for(let i=0;i<=e;i++){let n=i/e,a=n*(o.length-1),c=Math.floor(a),d=a-c,u=c<o.length-1?r(o[c],o[c+1],d):o[o.length-1];l.push(`rgba(${u[0]}, ${u[1]}, ${u[2]}, 0.8)`)}return{indexFor:o=>Math.max(Math.min(Math.floor((o-t[0])/(t[1]-t[0])*e),e),0),getColor:e=>l[e]}}function randomizeParticle(e){return e.x=Math.random()*bounds.width,e.y=Math.random()*bounds.height,e.age=100*Math.random(),e}function evolve(e,t){e.forEach(e=>{e.age>100&&randomizeParticle(e);let o=t.interpolate(e.x,e.y),r=o[2];o&&null!==r?(e.x+=.5*o[0],e.y+=.5*o[1],(e.x>bounds.width||e.x<0||e.y>bounds.height||e.y<0)&&randomizeParticle(e)):e.age=100,e.age++})}function draw(e,t,o,r){r.globalCompositeOperation="destination-in",r.fillStyle="rgba(0, 0, 0, 0.95)",r.fillRect(bounds.x,bounds.y,bounds.width,bounds.height),r.globalCompositeOperation="lighter",r.lineWidth=1,e.forEach(e=>{let l=t.interpolate(e.x,e.y),i=l[2],n=l[0]/i,a=l[1]/i,c=o.indexFor(l[3]);r.strokeStyle=o.getColor(c),r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(e.x-n,e.y-a),r.stroke()})}function frame(e,t,o,r){evolve(e,t),draw(e,t,o,r),setTimeout(()=>requestAnimationFrame(()=>frame(e,t,o,r)),25)}frame(particles1,vectorField1,vectorColorScale1,ctx1),frame(particles2,vectorField2,vectorColorScale2,ctx2);